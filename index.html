<script>
  const urlParams = new URLSearchParams(window.location.search);
  const isAdmin = urlParams.get("admin") === "1";

  const uploadSection = document.getElementById("uploadSection");
  const modal = document.getElementById("modal");

  if (isAdmin) {
    uploadSection.style.display = "block";
  }

  async function loadSkins() {
    try {
      const response = await fetch("https://joni007op.github.io/MinecraftSkins/skins.json");
      if (!response.ok) throw new Error("Datei konnte nicht geladen werden.");
      const data = await response.json();
      return data;
    } catch (error) {
      console.error("Fehler beim Laden der Skins:", error);
      return [];
    }
  }

  async function renderGallery() {
    const gallery = document.getElementById("gallery");
    gallery.innerHTML = "";
    const skins = await loadSkins();
    skins.forEach((skin, index) => {
      const div = document.createElement("div");
      div.className = "skin-box";
      const img = document.createElement("img");
      img.src = skin.displayData;
      img.alt = skin.name;
      div.appendChild(img);
      div.onclick = () => openModal(skins, index);
      gallery.appendChild(div);
    });
  }

  function openModal(skins, index) {
    const skin = skins[index];
    document.getElementById("modalImg").src = skin.displayData;
    document.getElementById("modalName").innerText = skin.name;
    document.getElementById("downloadBtn").onclick = () => {
      const a = document.createElement("a");
      a.href = skin.downloadData;
      a.download = skin.name + ".png";
      a.click();
    };
    document.getElementById("closeBtn").onclick = () => {
      modal.style.display = "none";
    };
    document.getElementById("deleteBtn").style.display = "none";
    modal.style.display = "flex";
  }

  window.onload = renderGallery;
</script>
